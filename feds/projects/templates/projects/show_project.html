{% extends "base.html" %}
{% block page_title %}Project: {{ project.title }}{% endblock %}
{% block page_heading %}Project: {{ project.title }}{% endblock %}
{% block content %}
    <div id="modal-dialog" class="modal" style="display:none;">
        <p>FEDS</p>
        <form action="" method="post">
            {% csrf_token %}
            <div id="feds-widget"></div>
            <div class="pull-right">
                <a class="btn btn-primary"
                   onclick="saveSetting();return false;"
                   role="button">Save</a>
                <a class="btn btn-default"
                   onclick="$.modal.close();return false;"
                   role="button">Cancel</a>
            </div>
        </form>
    </div>

    <script>
        $(document).ready(function(){
            $.modal.defaults = {
                showClose: false,
                fadeDuration: 200,
                fadeDelay: 0.5
            };
        });
        var fedsValidators = new Array();
        function showWidget(project_id, machine_name) {
            $.ajax({
                url: '{% url 'projects:request_setting_widget' %}',
                data: {
                    'projectid': project_id,
                    'machinename': machine_name
                },
                dataType: 'json',
                success: function (data) {
                    if (!data.widgethtml) {
                        alert("Bah! No widget HTML.");
                        return;
                    }
                    if (!data.validators) {
                        alert("Bah! No widget validators.");
                        return;
                    }
                    $('#feds-widget').html(data.widgethtml);
                    fedsValidators = data.validators;
                    $('#modal-dialog').modal();
                }
            });
        }
        function saveSetting() {
            $.modal.close();
        }
    </script>

    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <div class="row">
                    <div class="col-sm-3">
                        <strong>Title</strong>
                    </div>
                    <div class="col-sm-3">
                        {{ project.title }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <strong>Slug</strong>
                    </div>
                    <div class="col-sm-3">
                        {{ project.slug }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <strong>Description</strong>
                    </div>
                    <div class="col-sm-3">
                        {{ project.description }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <strong>Business area</strong>
                    </div>
                    <div class="col-sm-3">
                        {{ project.business_area.title }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <strong>Created</strong>
                    </div>
                    <div class="col-sm-3">
                        {{ project.when_created }}
                    </div>
                </div>
                {% if project.settings|length > 0 %}
                    <p class="feds-vert-margins-medium">
                        <a class="feds-plain-text-link" role="button"
                           data-toggle="collapse"
                           href="#setting{{ forloop.counter }}"
                           aria-expanded="false" aria-controls="">
                            Project settings <span
                                class="col-sm-offset-1 glyphicon glyphicon-menu-hamburger"
                                aria-hidden="true"></span>
                            {{ field_spec.title }}<br>
                            <span class="feds-setting-description">{{ field_spec.description }}</span>
                        </a>
                    </p>
                    <div class="collapse col-sm-8"
                         id="setting{{ forloop.counter }}">
                        {% for setting in project.settings %}
                            {% include 'projects/setting.html' with setting=setting %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="col-sm-offset-1 col-sm-4">
                <div class="row feds-vert-margins-small">
                    <a href="{% url 'projects:clone_project' project.db_id %}"
                       class="btn btn-primary"
                       title="Clone project">Clone project</a>
                    <a href="{% url 'projects:delete_project' project.db_id %}"
                       class="btn btn-danger pull-right"
                       style="margin-left: 40px;"
                       title="Delete project">Delete project</a>
                </div>
                <div class="row feds-vert-margins-small">
                    <a href="{% url 'projects:create_project' %}"
                       class="btn btn-primary"
                       title="Create a new project">Create new project</a>
                </div>
            </div>
        </div>
    </div>
    <hr>
    {% include 'projects/notional-tables.html' %}
{% endblock %}